{% extends "base.html" %} {% block title %}Dashboard - E-Commerce Analytics{%
endblock %} {% block content %}

<div class="container-fluid">
  <!-- Dashboard Header -->
  <div
    class="dashboard-header bg-gradient-primary text-white py-4 rounded-3 mb-4"
  >
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="display-6 fw-bold mb-2">
            <i class="fas fa-chart-dashboard me-2"></i>Indian E-commerce
            Analytics
          </h1>
          <p class="lead mb-0">Real-time insights and performance metrics</p>
        </div>
        <div class="col-md-4 text-md-end">
          <div
            class="last-update bg-dark bg-opacity-25 d-inline-block px-3 py-2 rounded-pill"
          >
            <small><i class="fas fa-sync-alt me-1"></i> Updated just now</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card kpi-card border-0 shadow-hover h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div
              class="kpi-icon bg-primary bg-opacity-10 rounded-circle p-3 me-3"
            >
              <i class="fas fa-users fa-2x text-primary"></i>
            </div>
            <div class="flex-grow-1">
              <h3 class="fw-bold text-primary mb-1">{{ total_users }}</h3>
              <p class="text-muted mb-0">Total Users</p>
              <small class="text-success">
                <i class="fas fa-arrow-up me-1"></i>12% growth
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card kpi-card border-0 shadow-hover h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div
              class="kpi-icon bg-success bg-opacity-10 rounded-circle p-3 me-3"
            >
              <i class="fas fa-box fa-2x text-success"></i>
            </div>
            <div class="flex-grow-1">
              <h3 class="fw-bold text-success mb-1">{{ total_products }}</h3>
              <p class="text-muted mb-0">Total Products</p>
              <small class="text-success">
                <i class="fas fa-arrow-up me-1"></i>8% growth
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card kpi-card border-0 shadow-hover h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div
              class="kpi-icon bg-warning bg-opacity-10 rounded-circle p-3 me-3"
            >
              <i class="fas fa-shopping-cart fa-2x text-warning"></i>
            </div>
            <div class="flex-grow-1">
              <h3 class="fw-bold text-warning mb-1">
                {{ total_transactions }}
              </h3>
              <p class="text-muted mb-0">Transactions</p>
              <small class="text-success">
                <i class="fas fa-arrow-up me-1"></i>15% growth
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card kpi-card border-0 shadow-hover h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="kpi-icon bg-info bg-opacity-10 rounded-circle p-3 me-3">
              <i class="fas fa-star fa-2x text-info"></i>
            </div>
            <div class="flex-grow-1">
              <h3 class="fw-bold text-info mb-1">{{ avg_rating }}</h3>
              <p class="text-muted mb-0">Avg Rating</p>
              <small class="text-success">
                <i class="fas fa-arrow-up me-1"></i>0.3 improvement
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="row">
    <!-- Top Products Section -->
    <div class="col-lg-8 mb-4">
      <div class="card border-0 shadow-hover h-100">
        <div class="card-header bg-transparent border-0 py-3">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="fw-bold mb-0">
              <i class="fas fa-crown text-warning me-2"></i>Top Performing
              Products
            </h5>
            <div class="dropdown">
              <button
                class="btn btn-sm btn-outline-secondary dropdown-toggle"
                type="button"
                data-bs-toggle="dropdown"
              >
                <i class="fas fa-filter me-1"></i>Filter
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">All Categories</a></li>
                <li><a class="dropdown-item" href="#">Electronics</a></li>
                <li><a class="dropdown-item" href="#">Clothing</a></li>
                <li><a class="dropdown-item" href="#">Home & Kitchen</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th class="border-0">Product</th>
                  <th class="border-0">Category</th>
                  <th class="border-0 text-end">Price</th>
                  <th class="border-0 text-center">Rating</th>
                  <th class="border-0 text-end">Sales</th>
                </tr>
              </thead>
              <tbody>
                {% for product in top_products %}
                <tr class="product-row">
                  <td>
                    <div class="d-flex align-items-center">
                      <div
                        class="product-avatar bg-primary bg-opacity-10 rounded-circle p-2 me-3"
                      >
                        <i class="fas fa-box-open text-primary"></i>
                      </div>
                      <div>
                        <h6 class="mb-0 fw-semibold">
                          {{ product.product_name }}
                        </h6>
                        <small class="text-muted"
                          >{{ product.brand if product.brand else 'Generic'
                          }}</small
                        >
                      </div>
                    </div>
                  </td>
                  <td>
                    <span class="badge bg-light text-dark"
                      >{{ product.category }}</span
                    >
                  </td>
                  <td class="text-end">
                    <span class="fw-bold text-success"
                      >₹{{ "%.2f"|format(product.price) }}</span
                    >
                  </td>
                  <td class="text-center">
                    <div class="star-rating">
                      {% for i in range(5) %} {% if i < product.rating|int %}
                      <i class="fas fa-star text-warning"></i>
                      {% else %}
                      <i class="far fa-star text-warning"></i>
                      {% endif %} {% endfor %}
                      <small class="text-muted ms-1"
                        >({{ "%.1f"|format(product.rating) }})</small
                      >
                    </div>
                  </td>
                  <td class="text-end">
                    <span class="fw-bold">{{ product.purchase_count }}</span>
                    <small class="text-muted">units</small>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Category Distribution & Insights -->
    <div class="col-lg-4 mb-4">
      <!-- Category Distribution -->
      <div class="card border-0 shadow-hover mb-4">
        <div class="card-header bg-transparent border-0 py-3">
          <h5 class="fw-bold mb-0">
            <i class="fas fa-chart-pie text-info me-2"></i>Category Distribution
          </h5>
        </div>
        <div class="card-body">
          <div class="category-chart-container">
            <canvas id="categoryChart" height="250"></canvas>
          </div>
          <div class="mt-3">
            {% for category in category_dist %}
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="d-flex align-items-center">
                <span
                  class="category-color me-2"
                  style="background-color: {{ ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'][loop.index0 % 6] }}; width: 12px; height: 12px; border-radius: 50%;"
                ></span>
                <span class="fw-semibold">{{ category.category }}</span>
              </div>
              <div class="text-end">
                <span class="fw-bold">{{ category.count }}</span>
                <small class="text-muted"
                  >({{ "%.1f"|format((category.count / total_transactions) *
                  100) }}%)</small
                >
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Quick Insights -->
      <div class="card border-0 shadow-hover">
        <div class="card-header bg-transparent border-0 py-3">
          <h5 class="fw-bold mb-0">
            <i class="fas fa-bolt text-warning me-2"></i>Quick Insights
          </h5>
        </div>
        <div class="card-body">
          <div class="insight-item d-flex align-items-center mb-3">
            <div
              class="insight-icon bg-primary bg-opacity-10 rounded-circle p-2 me-3"
            >
              <i class="fas fa-rupee-sign text-primary"></i>
            </div>
            <div>
              <h6 class="mb-0 fw-semibold">
                ₹{{ "%.2f"|format(insights.avg_price) }}
              </h6>
              <small class="text-muted">Average Product Price</small>
            </div>
          </div>

          <div class="insight-item d-flex align-items-center mb-3">
            <div
              class="insight-icon bg-success bg-opacity-10 rounded-circle p-2 me-3"
            >
              <i class="fas fa-tags text-success"></i>
            </div>
            <div>
              <h6 class="mb-0 fw-semibold">{{ insights.top_category }}</h6>
              <small class="text-muted">Most Popular Category</small>
            </div>
          </div>

          <div class="insight-item d-flex align-items-center mb-3">
            <div
              class="insight-icon bg-warning bg-opacity-10 rounded-circle p-2 me-3"
            >
              <i class="fas fa-shopping-bag text-warning"></i>
            </div>
            <div>
              <h6 class="mb-0 fw-semibold">
                {{ "%.1f"|format(insights.avg_products_per_user) }}
              </h6>
              <small class="text-muted">Products per User</small>
            </div>
          </div>

          <div class="insight-item d-flex align-items-center">
            <div
              class="insight-icon bg-info bg-opacity-10 rounded-circle p-2 me-3"
            >
              <i class="fas fa-chart-line text-info"></i>
            </div>
            <div>
              <h6 class="mb-0 fw-semibold">
                {{ "%.1f"|format((total_transactions / total_users)) }}
              </h6>
              <small class="text-muted">Avg Transactions per User</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Additional Metrics -->
  <div class="row mt-4">
    <div class="col-md-4 mb-4">
      <div class="card border-0 shadow-hover h-100">
        <div class="card-body text-center p-4">
          <div
            class="metric-icon bg-primary bg-gradient rounded-circle mx-auto mb-3"
          >
            <i class="fas fa-money-bill-wave text-white fa-2x"></i>
          </div>
          <h3 class="fw-bold text-primary">
            ₹{{ "%.0f"|format(insights.avg_price * total_transactions * 0.1) }}
          </h3>
          <p class="text-muted mb-0">Estimated Revenue</p>
          <small class="text-success">
            <i class="fas fa-arrow-up me-1"></i>18% from last month
          </small>
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-4">
      <div class="card border-0 shadow-hover h-100">
        <div class="card-body text-center p-4">
          <div
            class="metric-icon bg-success bg-gradient rounded-circle mx-auto mb-3"
          >
            <i class="fas fa-user-check text-white fa-2x"></i>
          </div>
          <h3 class="fw-bold text-success">
            {{ "%.1f"|format(avg_rating) }}/5
          </h3>
          <p class="text-muted mb-0">Customer Satisfaction</p>
          <div class="star-rating justify-content-center">
            {% for i in range(5) %} {% if i < avg_rating|int %}
            <i class="fas fa-star text-warning"></i>
            {% else %}
            <i class="far fa-star text-warning"></i>
            {% endif %} {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-4">
      <div class="card border-0 shadow-hover h-100">
        <div class="card-body text-center p-4">
          <div
            class="metric-icon bg-warning bg-gradient rounded-circle mx-auto mb-3"
          >
            <i class="fas fa-rocket text-white fa-2x"></i>
          </div>
          <h3 class="fw-bold text-warning">
            {{ "%.0f"|format((total_transactions / 30)) }}/day
          </h3>
          <p class="text-muted mb-0">Average Daily Transactions</p>
          <small class="text-success">
            <i class="fas fa-arrow-up me-1"></i>22% growth
          </small>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Category Distribution Chart
    const categoryData = {{ category_dist | tojson }};

    if (categoryData && categoryData.length > 0) {
      const categories = categoryData.map(item => item.category);
      const counts = categoryData.map(item => item.count);

      const colors = [
        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
        '#9966FF', '#FF9F40', '#8AC926', '#1982C4',
        '#6A4C93', '#F15BB5'
      ];

      const ctx = document.getElementById('categoryChart').getContext('2d');

      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: categories,
          datasets: [{
            data: counts,
            backgroundColor: colors.slice(0, categories.length),
            borderWidth: 2,
            borderColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '70%',
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.raw || 0;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = Math.round((value / total) * 100);
                  return `${label}: ${value} (${percentage}%)`;
                }
              }
            }
          }
        }
      });
    }

    // Add hover effects to table rows
    const productRows = document.querySelectorAll('.product-row');
    productRows.forEach(row => {
      row.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-2px)';
        this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
      });

      row.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = 'none';
      });
    });

    // Animate numbers on scroll
    const observerOptions = {
      threshold: 0.5,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animate-in');
        }
      });
    }, observerOptions);

    // Observe KPI cards for animation
    document.querySelectorAll('.kpi-card').forEach(card => {
      observer.observe(card);
    });
  });
</script>
{% endblock %}
